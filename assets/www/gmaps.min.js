GMaps=function(a){var b=this;var c="position:absolute;display:none;min-width:100px;background:white;\n  list-style:none;padding:8px;box-shadow:2px 2px 6px #ccc";window.context_menu={};this.geocoder=new google.maps.Geocoder;this.div=$(a.div)[0];this.overlays=[];this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_div=null;this.zoom=a.zoom||15;if(a.mapType)var d=google.maps.MapTypeId[a.mapType.toUpperCase()];else var d=google.maps.MapTypeId.ROADMAP;var e=new google.maps.LatLng(a.lat,a.lng);delete a["lat"];delete a["lng"];delete a["mapType"];var f={zoom:this.zoom,center:e,mapTypeId:d};var g=$.extend(f,a);this.map=new google.maps.Map(this.div,g);var h=navigator.userAgent.toLowerCase();var j=h.match(/(iphone|ipod|ipad)/)!=null;var k=h.match(/(iphone|ipod|ipad|android)/)!=null;var l=k?"touchend":"click";var m=function(a,c){var d="";for(i in window.context_menu[a]){option=window.context_menu[a][i];d+='<li><a id="'+a+"_"+i+'" href="#">'+option.title+"</a></li>"}$("#gmaps_context_menu").html(d);$("#gmaps_context_menu li a").die();$("#gmaps_context_menu li a").live(l,function(d){d.preventDefault();window.context_menu[a][$(this).attr("id").replace(a+"_","")].action.call(b,c);b.hideContextMenu()});var e=$(b.div).offset().left+c.pixel.x-15;var f=$(b.div).offset().top+c.pixel.y-15;$("#gmaps_context_menu").css({left:e,top:f}).fadeIn(200)};var n=function(a,c){if(a=="marker"){c.pixel={};overlay=new google.maps.OverlayView;overlay.setMap(b.map);overlay.draw=function(){projection=overlay.getProjection();position=c.marker.getPosition();c.pixel=projection.fromLatLngToContainerPixel(position);m(a,c)}}else{m(a,c)}};this.setContextMenu=function(a){window.context_menu[a.control]={};var b='<ul id="gmaps_context_menu" style="'+c+'"></ul>';for(i in a.options){option=a.options[i];window.context_menu[a.control][option.name]={title:option.title,action:option.action}}$("body").append(b);$("#gmaps_context_menu").live("mouseleave",function(){$(this).delay(100).fadeOut(200)})};this.hideContextMenu=function(){$("#gmaps_context_menu").fadeOut(200)};if(a.bounds_changed){google.maps.event.addListener(this.map,"bounds_changed",function(c){a.bounds_changed(c);b.hideContextMenu()})}if(a.center_changed){google.maps.event.addListener(this.map,"center_changed",function(c){a.center_changed(c);b.hideContextMenu()})}if(a.click){google.maps.event.addListener(this.map,"click",function(c){a.click(c);b.hideContextMenu()})}if(a.dblclick){google.maps.event.addListener(this.map,"dblclick",function(c){a.dblclick(c);b.hideContextMenu()})}if(a.drag){google.maps.event.addListener(this.map,"drag",function(c){a.drag(c);b.hideContextMenu()})}if(a.dragend){google.maps.event.addListener(this.map,"dragend",function(c){a.dragend(c);b.hideContextMenu()})}if(a.dragstart){google.maps.event.addListener(this.map,"dragstart",function(c){a.dragstart(c);b.hideContextMenu()})}if(a.idle){google.maps.event.addListener(this.map,"idle",function(c){a.idle(c);b.hideContextMenu()})}if(a.maptypeid_changed){google.maps.event.addListener(this.map,"maptypeid_changed",function(c){a.maptypeid_changed(c);b.hideContextMenu()})}if(a.mousemove){google.maps.event.addListener(this.map,"mousemove",function(b){a.mousemove(b)})}if(a.mouseout){google.maps.event.addListener(this.map,"mouseout",function(b){a.mouseout(b)})}if(a.mouseover){google.maps.event.addListener(this.map,"mouseover",function(b){a.mouseover(b)})}if(a.projection_changed){google.maps.event.addListener(this.map,"projection_changed",function(c){a.projection_changed(c);b.hideContextMenu()})}if(a.resize){google.maps.event.addListener(this.map,"resize",function(c){a.resize(c);b.hideContextMenu()})}if(a.rightclick){google.maps.event.addListener(this.map,"rightclick",function(b){a.rightclick(b);n("map",b)})}if(a.tilesloaded){google.maps.event.addListener(this.map,"tilesloaded",function(c){a.tilesloaded(c);b.hideContextMenu()})}if(a.zoom_changed){google.maps.event.addListener(this.map,"zoom_changed",function(c){a.zoom_changed(c);b.hideContextMenu()})}this.fixResize=function(){google.maps.event.trigger(this.map,"resize")};this.fitBounds=function(a){var b=a.length;var c=new google.maps.LatLngBounds;for(var d=0;d<b;++d){c.extend(a[d])}this.map.fitBounds(c)};this.geolocate=function(a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(b){a.success(b);if(a.always)a.always()},function(b){a.error(b);if(a.always)a.always()},a.options)}else{a.not_supported();if(a.always)a.always()}};this.setCenter=function(a,b,c){this.map.panTo(new google.maps.LatLng(a,b));if(c)c()};this.getCenter=function(){return this.map.getCenter()};this.getDiv=function(){return this.div};this.setZoom=function(a){this.map.setZoom(a)};this.zoomIn=function(a){this.map.setZoom(this.map.getZoom()+a)};this.zoomOut=function(a){this.map.setZoom(this.map.getZoom()-a)};this.createMarker=function(a){if(a.lat&&a.lng){var b=this;var c=a.details;var d=a.fences;var e=a.outside;var f={position:new google.maps.LatLng(a.lat,a.lng),map:null};delete a.lat;delete a.lng;delete a.fences;delete a.outside;var g=$.extend(f,a);var h=new google.maps.Marker(g);h["fences"]=d;if(a.infoWindow)h.infoWindow=new google.maps.InfoWindow(a.infoWindow);if(a.click){google.maps.event.addListener(h,"click",function(){this["details"]=c;a.click.apply(this,[this]);if(h.infoWindow){b.hideInfoWindows();h.infoWindow.open(b.map,h)}})}if(a.dragend){google.maps.event.addListener(h,"dragend",function(){a.dragend(this);if(h.fences)b.checkMarkerGeofence(h,function(a,b){e(a,b)})})}if(a.mouseout){google.maps.event.addListener(h,"mouseout",function(){a.mouseout(this)})}if(a.mouseover){google.maps.event.addListener(h,"mouseover",function(){a.mouseover(this)})}if(a.mouseover){google.maps.event.addListener(h,"mouseover",function(){a.mouseover(this)})}if(a.position_changed){google.maps.event.addListener(h,"position_changed",function(){a.position_changed(this)})}return h}else{throw"No latitude or longitude defined";return null}};this.addMarker=function(a){if(a.lat&&a.lng){marker=this.createMarker(a);marker.setMap(this.map);this.markers.push(marker);return marker}else{throw"No latitude or longitude defined";return null}};this.addMarkers=function(a){for(marker in a)this.addMarker(marker);return this.markers};this.hideInfoWindows=function(){for(index in this.markers){marker=this.markers[index];if(marker.infoWindow)marker.infoWindow.close()}};this.removeMarker=function(a){a.setMap(null)};this.removeMarkers=function(){for(index in this.markers){this.removeMarker(this.markers[index])}this.markers=[]};this.removePolylines=function(){for(index in this.polylines){this.removePolyline(this.polylines[index])}this.polylines=[]};this.removePolyline=function(a){a.setMap(null)};this.drawOverlay=function(a){var c=new google.maps.OverlayView;c.setMap(b.map);c.onAdd=function(){var c=document.createElement("div");c.style.borderStyle="none";c.style.borderWidth="0px";c.style.position="absolute";c.innerHTML=a.content;b.overlay_div=c;var d=this.getPanes();if(!a.layer)a.layer="overlayLayer";var e=d[a.layer];e.appendChild(c)};c.draw=function(){projection=this.getProjection();pixel=projection.fromLatLngToDivPixel(new google.maps.LatLng(a.lat,a.lng));a.horizontalOffset=a.horizontalOffset||0;a.verticalOffset=a.verticalOffset||0;div=b.overlay_div;content=div.children;$content=$(content);$btnLeft=$content.find(".overlay-btn-left");if($btnLeft.length>0){$btnLeft.css({opacity:.5,cursor:"auto"});if(a.clickButtonLeft){$btnLeft.bind(l,function(b){b.preventDefault();b.stopPropagation();a.clickButtonLeft(b)});$btnLeft.css({opacity:1,cursor:"pointer"})}}$btnRight=$content.find(".overlay-btn-right");if($btnRight.length>0){$btnRight.css({opacity:.5,cursor:"auto"});if(a.clickButtonRight){$btnRight.bind(l,function(b){b.preventDefault();b.stopPropagation();a.clickButtonRight(b)});$btnRight.css({opacity:1,cursor:"pointer"})}}var c=235;$title=$content.find(".overlay-title");if($title.length>0)$title.excerpt(c);$subtitle=$content.find(".overlay-subtitle");if($subtitle.length>0)$subtitle.excerpt(c);textContainerWidth=$content.find(".overlar-text-container").width();$(content).width(textContainerWidth+32*($btnRight.length>0?2:1));div.style.opacity=0;switch(a.verticalAlign){case"top":div.style.top=pixel.y-$(content).height()+a.verticalOffset+"px";break;default:case"middle":div.style.top=pixel.y-$(content).height()/2+a.verticalOffset+"px";break;case"bottom":div.style.top=pixel.y+a.verticalOffset+"px";break}switch(a.horizontalAlign){case"left":div.style.left=pixel.x-$(content).width()+a.horizontalOffset+"px";break;default:case"center":div.style.left=pixel.x-$(content).width()/2+a.horizontalOffset+"px";break;case"right":div.style.left=pixel.x+a.horizontalOffset+"px";break}$(div).animate({opacity:1},"fast")};c.onRemove=function(){b.overlay_div.parentNode.removeChild(b.overlay_div);b.overlay_div=null};b.overlays.push(c);return c};this.removeOverlay=function(a){a.setMap(null)};this.removeOverlays=function(){for(i in b.overlays){item=b.overlays[i];item.setMap(null)}b.overlays=[]};this.drawPolyline=function(a){var b=[];if(a.path.length){if(a.path[0][0]==undefined){b=a.path}else{points=a.path;for(i in points){latlng=points[i];b.push(new google.maps.LatLng(latlng[0],latlng[1]))}}}var c=new google.maps.Polyline({map:this.map,path:b,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});this.polylines.push(c);return c};this.drawCircle=function(a){a=$.extend({map:this.map,center:new google.maps.LatLng(a.lat,a.lng)},a);delete a["lat"];delete a["lng"];var b=new google.maps.Circle(a);google.maps.event.addListener(b,"click",function(b){if(a.click)a.click(b)});google.maps.event.addListener(b,"dblclick",function(b){if(a.dblclick)a.dblclick(b)});google.maps.event.addListener(b,"mousedown",function(b){if(a.mousedown)a.mousedown(b)});google.maps.event.addListener(b,"mousemove",function(b){if(a.mousemove)a.mousemove(b)});google.maps.event.addListener(b,"mouseout",function(b){if(a.mouseout)a.mouseout(b)});google.maps.event.addListener(b,"mouseover",function(b){if(a.mouseover)a.mouseover(b)});google.maps.event.addListener(b,"mouseup",function(b){if(a.mouseup)a.mouseup(b)});google.maps.event.addListener(b,"rightclick",function(b){if(a.rightclick)a.rightclick(b)});return b};this.drawPolygon=function(a){a=$.extend({map:this.map},a);var b=new google.maps.Polygon(a);google.maps.event.addListener(b,"click",function(b){if(a.click)a.click(b)});google.maps.event.addListener(b,"dblclick",function(b){if(a.dblclick)a.dblclick(b)});google.maps.event.addListener(b,"mousedown",function(b){if(a.mousedown)a.mousedown(b)});google.maps.event.addListener(b,"mousemove",function(b){if(a.mousemove)a.mousemove(b)});google.maps.event.addListener(b,"mouseout",function(b){if(a.mouseout)a.mouseout(b)});google.maps.event.addListener(b,"mouseover",function(b){if(a.mouseover)a.mouseover(b)});google.maps.event.addListener(b,"mouseup",function(b){if(a.mouseup)a.mouseup(b)});google.maps.event.addListener(b,"rightclick",function(b){if(a.rightclick)a.rightclick(b)});this.polygons.push(b);return b};this.getRoutes=function(a){switch(a.travelMode){case"bicycling":travelMode=google.maps.TravelMode.BICYCLING;break;case"driving":travelMode=google.maps.TravelMode.DRIVING;break;case"walking":default:travelMode=google.maps.TravelMode.WALKING;break}var b=this;var c=new google.maps.DirectionsService;c.route({origin:new google.maps.LatLng(a.origin[0],a.origin[1]),destination:new google.maps.LatLng(a.destination[0],a.destination[1]),travelMode:travelMode},function(c,d){if(d==google.maps.DirectionsStatus.OK){for(i in c.routes){route=c.routes[i];b.routes.push(route)}}if(a.callback)a.callback(b.routes)})};this.drawRoute=function(a){var b=this;this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(c){if(c.length>0){path=c[c.length-1].overview_path;b.drawPolyline({path:path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});if(a.callback)a.callback(c[c.length-1])}}})};this.travelRoute=function(a){if(a.origin&&a.destination){this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(b){if(b.length>0&&a.step){route=b[b.length-1];if(route.legs.length>0)for(i in route.legs[0].steps){step=route.legs[0].steps[i];step["step_number"]=i;a.step(step)}}}})}else if(a.route){if(a.route.legs.length>0){for(i in a.route.legs[0].steps){step=a.route.legs[0].steps[i];step["step_number"]=i;a.step(step)}}}};this.drawSteppedRoute=function(a){if(a.origin&&a.destination){this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(c){if(c.length>0&&a.step){route=c[c.length-1];if(route.legs.length>0)for(i in route.legs[0].steps){step=route.legs[0].steps[i];step["step_number"]=i;b.drawPolyline({path:step.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.step(step)}}}})}else if(a.route){if(a.route.legs.length>0){for(i in a.route.legs[0].steps){step=a.route.legs[0].steps[i];step["step_number"]=i;b.drawPolyline({path:step.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.step(step)}}}};this.geocode=function(a){var b=a.callback;if(a.lat&&a.lng)a["latLng"]=new google.maps.LatLng(a.lat,a.lng);delete a.lat;delete a.lng;delete a.callback;this.geocoder.geocode(a,function(a,c){b(a,c)})};this.checkGeofence=function(a,b,c){return c.containsLatLng(new google.maps.LatLng(a,b))};this.checkMarkerGeofence=function(a,c){if(a.fences){for(i in a.fences){fence=a.fences[i];if(!b.checkGeofence(a.getPosition().lat(),a.getPosition().lng(),fence))c(a,fence)}}}};GMaps.Route=function(a){this.map=a.map;this.route=a.route;this.path=this.route.overview_path;this.steps=this.path.length;this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});this.polyline=this.map.polylines[this.map.polylines.length-1].getPath();this.polyline.push(this.route.overview_path[0]);this.path_length=this.polyline.getLength();this.back=function(){if(this.path_length>0){this.polyline.pop();this.path_length--}};this.forward=function(){if(this.path_length<this.steps){this.polyline.push(this.path[this.path_length]);this.path_length++}}};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(a){var b=new google.maps.LatLngBounds;var c=this.getPaths();var d;for(var e=0;e<c.getLength();e++){d=c.getAt(e);for(var f=0;f<d.getLength();f++){b.extend(d.getAt(f))}}return b}}google.maps.Polygon.prototype.containsLatLng=function(a){var b=this.getBounds();if(b!=null&&!b.contains(a)){return false}var c=false;var d=this.getPaths().getLength();for(var e=0;e<d;e++){var f=this.getPaths().getAt(e);var g=f.getLength();var h=g-1;for(var i=0;i<g;i++){var j=f.getAt(i);var k=f.getAt(h);if(j.lng()<a.lng()&&k.lng()>=a.lng()||k.lng()<a.lng()&&j.lng()>=a.lng()){if(j.lat()+(a.lng()-j.lng())/(k.lng()-j.lng())*(k.lat()-j.lat())<a.lat()){c=!c}}h=i}}return c};google.maps.LatLngBounds.prototype.containsLatLng=function(a){return this.contains(a)};google.maps.Marker.prototype.setFences=function(a){this.fences=a};google.maps.Marker.prototype.addFence=function(a){this.fences.push(a)}